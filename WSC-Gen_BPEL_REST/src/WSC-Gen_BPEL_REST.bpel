<?xml version="1.0" encoding="UTF-8" ?>
<process
    name="WSC-Gen_BPEL_REST"
    targetNamespace="http://enterprise.netbeans.org/bpel/WSC-Gen_BPEL_REST/WSC-Gen_BPEL_REST"
    xmlns:tns="http://enterprise.netbeans.org/bpel/WSC-Gen_BPEL_REST/WSC-Gen_BPEL_REST"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:xsd="http://www.w3.org/2001/XMLSchema"
    xmlns="http://docs.oasis-open.org/wsbpel/2.0/process/executable"
    xmlns:sxt="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Trace" 
    xmlns:sxed="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Editor2"
    xmlns:sxat="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/Attachment"
    xmlns:sxeh="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/ErrorHandling" xmlns:sxnmp="http://www.sun.com/wsbpel/2.0/process/executable/SUNExtension/NMProperty">
    <import namespace="http://j2ee.netbeans.org/wsdl/WSC-Gen_BPEL_REST/src/Generator_RESTservice" location="Generator_RESTservice.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <import namespace="http://j2ee.netbeans.org/wsdl/WSC-Gen_BPEL_REST/src/Generator_Client_REST" location="Generator_Client_REST.wsdl" importType="http://schemas.xmlsoap.org/wsdl/"/>
    <partnerLinks>
        <partnerLink name="Client" xmlns:tns="http://j2ee.netbeans.org/wsdl/WSC-Gen_BPEL_REST/src/Generator_Client_REST" partnerLinkType="tns:Generator_Client_REST" myRole="Generator_Client_RESTPortTypeRole"/>
        <partnerLink name="Generator" xmlns:tns="http://j2ee.netbeans.org/wsdl/WSC-Gen_BPEL_REST/src/Generator_RESTservice" partnerLinkType="tns:RestOutboundWSDL" partnerRole="RestOutboundPortTypeRole"/>
    </partnerLinks>
    <variables>
        <variable name="GetGeneratedfileOut" xmlns:tns="http://j2ee.netbeans.org/wsdl/WSC-Gen_BPEL_REST/src/Generator_RESTservice" messageType="tns:getGeneratedfileResponse"/>
        <variable name="GetGeneratedfileIn" xmlns:tns="http://j2ee.netbeans.org/wsdl/WSC-Gen_BPEL_REST/src/Generator_RESTservice" messageType="tns:getGeneratedfileRequest"/>
        <variable name="GenerateOut" xmlns:tns="http://j2ee.netbeans.org/wsdl/WSC-Gen_BPEL_REST/src/Generator_RESTservice" messageType="tns:generateResponse"/>
        <variable name="GenerateIn" xmlns:tns="http://j2ee.netbeans.org/wsdl/WSC-Gen_BPEL_REST/src/Generator_RESTservice" messageType="tns:generateRequest"/>
        <variable name="FileContent_ClientOutput" xmlns:tns="http://j2ee.netbeans.org/wsdl/WSC-Gen_BPEL_REST/src/Generator_Client_REST" messageType="tns:Generator_Client_RESTOperationResponse"/>
        <variable name="fileType_ClientIn" xmlns:tns="http://j2ee.netbeans.org/wsdl/WSC-Gen_BPEL_REST/src/Generator_Client_REST" messageType="tns:Generator_Client_RESTOperationRequest"/>
    </variables>
    <sequence>
        <receive name="Receive1" createInstance="yes" partnerLink="Client" operation="Generator_Client_RESTOperation" xmlns:tns="http://j2ee.netbeans.org/wsdl/WSC-Gen_BPEL_REST/src/Generator_Client_REST" portType="tns:Generator_Client_RESTPortType" variable="fileType_ClientIn"/>
        <assign name="Assign1">
            <copy>
                <from>''</from>
                <to variable="GenerateIn" part="part1"/>
            </copy>
            <copy>
                <from>string('http://localhost:8080/WSC-Gen/resources/restGenerator/gen')</from>
                <to variable="GenerateIn" sxnmp:nmProperty="org.glassfish.openesb.rest.url"/>
            </copy>
        </assign>
        <invoke name="Invoke1" partnerLink="Generator" operation="generate" xmlns:tns="http://j2ee.netbeans.org/wsdl/WSC-Gen_BPEL_REST/src/Generator_RESTservice" portType="tns:RestOutboundPortType" inputVariable="GenerateIn" outputVariable="GenerateOut"/>
        <if name="If1">
            <condition>$GenerateOut.part1</condition>
            <sequence name="Sequence1">
                <assign name="Assign2">
                    <copy>
                        <from>''</from>
                        <to variable="GetGeneratedfileIn" part="part1"/>
                    </copy>
                    <copy>
                        <from>concat('http://localhost:8080/WSC-Gen/resources/restGenerator/gen/', $fileType_ClientIn.part1)</from>
                        <to variable="GetGeneratedfileIn" sxnmp:nmProperty="org.glassfish.openesb.rest.url"/>
                    </copy>
                </assign>
                <invoke name="Invoke2" partnerLink="Generator" operation="getGeneratedfile" xmlns:tns="http://j2ee.netbeans.org/wsdl/WSC-Gen_BPEL_REST/src/Generator_RESTservice" portType="tns:RestOutboundPortType" inputVariable="GetGeneratedfileIn" outputVariable="GetGeneratedfileOut"/>
                <assign name="Assign3">
                    <copy>
                        <from>concat(string($GetGeneratedfileOut.part1), string(sxnmp:getVariableNMProperty('GetGeneratedfileOut', 'org.glassfish.openesb.rest.response.url')))</from>
                        <to variable="FileContent_ClientOutput" part="ClientResponse"/>
                    </copy>
                </assign>
                <reply name="Reply1" partnerLink="Client" operation="Generator_Client_RESTOperation" xmlns:tns="http://j2ee.netbeans.org/wsdl/WSC-Gen_BPEL_REST/src/Generator_Client_REST" portType="tns:Generator_Client_RESTPortType" variable="FileContent_ClientOutput"/>
            </sequence>
        </if>
    </sequence>
</process>
